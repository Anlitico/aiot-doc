# 生产烧录与配置工具指南 (Factory Production & Provisioning)

本指南针对 500 台小规模量产，提供低成本、高效率的固件烧录与设备唯一身份 (SN) 授权方案。

---

## 1. 批量烧录方案 (Firmware Burning)

由于 ESP32-S3 支持 USB 直接烧录，我们建议：
- **样机期**：使用 `esptool` 或 `ESP-IDF` 手动单台烧录。
- **量产期 (500台)**：
    - **治具设计**：由结构工程师在主板上预留 4 个 **弹簧探针 (Pogo Pin)** 测试点 (TX, RX, IO0, GND)。
    - **烧录器**：使用“一拖四”或“一拖八”的离线烧录器，插上即烧，无需电脑人工干预。

---

## 2. 设备唯一标识 (Device Provisioning)

每一台 AI 公仔必须拥有唯一的序列号 (SN) 和可能的云端授权秘钥。

### 2.1 存储位置：NVS 分区
- 将 SN 和 Wi-Fi 证书存储在 ESP32 的 **NVS (Non-volatile Storage) 闪存分区**。
- **防止丢失**：该分区应标记为 `read-only` 且在烧录新固件时不被覆盖。

### 2.2 二维码配对逻辑
- 在公仔底座或说明书上张贴 **SN 对应二维码**。
- 用户通过 App/小程序扫码时，云端根据该 SN 分配对应的“名人性格包”。

---

## 3. 产线辅助工具 (Internal Tools)

为了帮助工厂快速判定，建议固件包含一个“**工厂模式**”：
- **触发方式**：开机时连按隐藏键 5 次。
- **动作**：
  1. LED 自动轮流显示红、绿、蓝（自检灯珠）。
  2. 自动循环播放一段 5 秒音频（自检喇叭）。
  3. 进行一次 1 秒录音回放（自检麦克风）。
- **目的**：工人只需 10 秒即可判定该台机器是否为合格品。

---

## 4. 生产 Checklist
- [ ] **固件锁定**：确保量产固件已关闭调试串口输出 (Disable UART Console)，防止被逆向破解。
- [ ] **Flash 加密**：对于商业版本，建议开启 ESP32-S3 的 Flash Encryption 保护固件资产。
- [ ] **证书预置**：确保首批 500 个云端通信证书已由你自己生成并保存好备份。
