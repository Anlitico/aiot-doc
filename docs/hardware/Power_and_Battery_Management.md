# 电源管理与电池设计指南：让玩具持久待机

ESP32-S3 与 WebRTC 的组合决定了本产品是一个高功耗设备。本指南旨在平衡续航时间、充电效率与安全性。

## 1. 功耗预算 (Power Budget)

在 3.7V 锂电池供电下，系统电流预估：
- **持续对话 (Wi-Fi + AFE + Opus + 喇叭)**：平均 180mA - 250mA。
- **浅睡眠 (Wi-Fi 保持连接，监听唤醒词)**：约 50mA - 80mA。
- **深度睡眠 (等待物理按键触发)**：< 20uA (微安级)。

| 电池容量 | 持续通话时间 | 推荐场景 |
| :--- | :--- | :--- |
| **500 mAh** | ~2 小时 | 极端紧凑型，续航体验差 |
| **1000 mAh** | **~4.5 小时** | **主流推荐，性价比与空间平衡点** |
| **2000 mAh** | ~9 小时 | 体积巨大，适合大型桌面公仔 |

### 2. 1000mAh 电池的物理规格参考
针对 1000mAh 电池，供应链常见的标准尺寸型号如下：
- **型号 603450 (推荐)**：厚 6.0mm x 宽 34mm x 长 50mm。
- **视觉参考**：约 3 张身份证叠放的厚度，面积比身份证略小。
- **设计建议**：在海绵宝宝内部预留空间时，请按 **7.0mm x 36mm x 52mm** 进行开孔（预留 1-2mm 的充放电胀气空间）。

### 3. 电池选型与安全

### 2.1 类型推荐
- **聚合物锂电池 (Li-Po)**：能量密度高，形状扁平，方便塞进公仔内部。
- **要求**：必须带有 **双重保护板 (PCM)**，防止过充、过放和短路。玩具在成人手中也存在挤压风险，安全性是第一位的。

### 2.2 连接方式
- **PH 2.0 插件**：不要直接把电池焊在 PCB 上，量产和维修时极难操作。使用插头连接。

### 3. 充电与稳压电路设计细节

### 3.1 充电电流设定 (Charger Programming)
采用 **TP4056** 线性充电方案。
- **计算逻辑**：充电电流 $I_{chg}(mA) \approx \frac{1200}{R_{prog}(k\Omega)}$。
- **设计建议**：为了 1000mAh 电池的寿命与发热平衡，建议将 $R_{prog}$ 设为 **1.5k\Omega**，对应充电电流约 **800mA**。
- **指示灯**：建议预留“红灯（充电中）/ 绿灯（充满）”双色指示，可导光至海绵宝宝的某个身体部位。

### 3.2 锂电池电量监测电路 (Battery Fuel Gauge)
由于 ESP32-S3 ADC 引脚建议输入电压在 3.1V 以下，而锂电池最高 4.2V。
- **电路方案**：采用高阻值分压法。
    - $R_{up} = 100k\Omega$, $R_{down} = 100k\Omega$ (精度需 $\pm 1\%$)。
    - 并联一刻 $0.1uF$ 陶瓷电容以滤除高频噪声。
- **软件处理**：ADC 采样值乘 2 即得到实际电池电压。当电压降至 **3.4V** 时，进入低功耗强制保护或提示用户。

### 3.3 稳压方案：SGM2212-3.3 (或同级别 800mA+ LDO)
- **核心理由**：ESP32-S3 在 Wi-Fi 传输合并音频功放工作时，峰值电流可达 **500mA-600mA**。300mA 级别的 LDO 会导致系统在高负载下频繁死机或重启。
- **输出电流能力**：额定 **800mA** 持续输出，完美覆盖 S3 的全速运行需求。
- **Layout 建议**：
    - LDO 输入端放置 1uF + 10uF 组合。
    - LDO 输出端（紧贴模组 3V3）必须放置 **22uF** 陶瓷电容，这是解决 Wi-Fi 掉线和系统复位的首要手段。

## 4. 低功耗逻辑设计 (提升体验)

### 4.1 自动关机逻辑
- 如果检测到后端 5 分钟没有语音下发，且麦克风没听人说话，自动进入 **Deep Sleep**。

### 4.2 物理唤醒
- 在海绵宝宝特定的部位安装一个 **电容式触摸传感器** (ESP32-S3 内置支持)。用户触摸该区域，系统瞬间唤醒并重连 Wi-Fi。

## 5. 电量检测
- 通过分压电阻连接到 ESP32 的 ADC 引脚。
- **低电提示**：当电压低于 3.4V 时，名人语音可以触发一句“我有点累了，帮我充个电吧”，而不是直接生硬关机。

---

## 6. 电源 Checklist (待同步)
- [ ] 确定是否需要快充功能（本规模不建议，增加成本）。
- [ ] 确保 USB-C 接口具有 ESD 保护，防止拔插静电击穿芯片。
- [ ] 实际测试 3.3V LDO 在 1A 峰值负载下的波纹电压。
